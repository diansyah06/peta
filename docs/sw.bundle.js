/*! For license information please see sw.bundle.js.LICENSE.txt */
(()=>{function t(n){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(n)}function n(t,n){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,n){if(t){if("string"==typeof t)return e(t,n);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?e(t,n):void 0}}(t))||n&&t&&"number"==typeof t.length){r&&(t=r);var o=0,i=function(){};return{s:i,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return c=t.done,t},e:function(t){u=!0,a=t},f:function(){try{c||null==r.return||r.return()}finally{if(u)throw a}}}}function e(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=Array(n);e<n;e++)r[e]=t[e];return r}function r(){"use strict";var t=s(),n=t.m(r),e=(Object.getPrototypeOf?Object.getPrototypeOf(n):n.__proto__).constructor;function f(t){var n="function"==typeof t&&t.constructor;return!!n&&(n===e||"GeneratorFunction"===(n.displayName||n.name))}var p={throw:1,return:2,break:3,continue:3};function d(t){var n,e;return function(r){n||(n={stop:function(){return e(r.a,2)},catch:function(){return r.v},abrupt:function(t,n){return e(r.a,p[t],n)},delegateYield:function(t,i,a){return n.resultName=i,e(r.d,o(t),a)},finish:function(t){return e(r.f,t)}},e=function(t,e,o){r.p=n.prev,r.n=n.next;try{return t(e,o)}finally{n.next=r.n}}),n.resultName&&(n[n.resultName]=r.v,n.resultName=void 0),n.sent=r.v,n.next=r.n;try{return t.call(this,n)}finally{r.p=n.prev,r.n=n.next}}}return(r=function(){return{wrap:function(n,e,r,o){return t.w(d(n),e,r,o&&o.reverse())},isGeneratorFunction:f,mark:t.m,awrap:function(t,n){return new l(t,n)},AsyncIterator:u,async:function(t,n,e,r,o){return(f(n)?c:a)(d(t),n,e,r,o)},keys:i,values:o}})()}function o(n){if(null!=n){var e=n["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],r=0;if(e)return e.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length))return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}}}throw new TypeError(t(n)+" is not iterable")}function i(t){var n=Object(t),e=[];for(var r in n)e.unshift(r);return function t(){for(;e.length;)if((r=e.pop())in n)return t.value=r,t.done=!1,t;return t.done=!0,t}}function a(t,n,e,r,o){var i=c(t,n,e,r,o);return i.next().then((function(t){return t.done?t.value:i.next()}))}function c(t,n,e,r,o){return new u(s().w(t,n,e,r),o||Promise)}function u(t,n){function e(r,o,i,a){try{var c=t[r](o),u=c.value;return u instanceof l?n.resolve(u.v).then((function(t){e("next",t,i,a)}),(function(t){e("throw",t,i,a)})):n.resolve(u).then((function(t){c.value=t,i(c)}),(function(t){return e("throw",t,i,a)}))}catch(t){a(t)}}var r;this.next||(f(u.prototype),f(u.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",(function(){return this}))),f(this,"_invoke",(function(t,o,i){function a(){return new n((function(n,r){e(t,i,n,r)}))}return r=r?r.then(a,a):a()}),!0)}function s(){var t,n,e="function"==typeof Symbol?Symbol:{},r=e.iterator||"@@iterator",o=e.toStringTag||"@@toStringTag";function i(e,r,o,i){var u=r&&r.prototype instanceof c?r:c,s=Object.create(u.prototype);return f(s,"_invoke",function(e,r,o){var i,c,u,s=0,f=o||[],l=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(n,e){return i=n,c=0,u=t,p.n=e,a}};function d(e,r){for(c=e,u=r,n=0;!l&&s&&!o&&n<f.length;n++){var o,i=f[n],d=p.p,v=i[2];e>3?(o=v===r)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=d&&((o=e<2&&d<i[1])?(c=0,p.v=r,p.n=i[1]):d<v&&(o=e<3||i[0]>r||r>v)&&(i[4]=e,i[5]=r,p.n=v,c=0))}if(o||e>1)return a;throw l=!0,r}return function(o,f,v){if(s>1)throw TypeError("Generator is already running");for(l&&1===f&&d(f,v),c=f,u=v;(n=c<2?t:u)||!l;){i||(c?c<3?(c>1&&(p.n=-1),d(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),n=i[o]){if(!(n=n.call(i,u)))throw TypeError("iterator result is not an object");if(!n.done)return n;u=n.value,c<2&&(c=0)}else 1===c&&(n=i.return)&&n.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((n=(l=p.n<0)?u:e.call(r,p))!==a)break}catch(n){i=t,c=1,u=n}finally{s=1}}return{value:n,done:l}}}(e,o,i),!0),s}var a={};function c(){}function u(){}function l(){}n=Object.getPrototypeOf;var p=[][r]?n(n([][r]())):(f(n={},r,(function(){return this})),n),d=l.prototype=c.prototype=Object.create(p);function v(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,f(t,o,"GeneratorFunction")),t.prototype=Object.create(d),t}return u.prototype=l,f(d,"constructor",l),f(l,"constructor",u),u.displayName="GeneratorFunction",f(l,o,"GeneratorFunction"),f(d),f(d,o,"Generator"),f(d,r,(function(){return this})),f(d,"toString",(function(){return"[object Generator]"})),(s=function(){return{w:i,m:v}})()}function f(t,n,e,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}f=function(t,n,e,r){function i(n,e){f(t,n,(function(t){return this._invoke(n,e,t)}))}n?o?o(t,n,{value:e,enumerable:!r,configurable:!r,writable:!r}):t[n]=e:(i("next",0),i("throw",1),i("return",2))},f(t,n,e,r)}function l(t,n){this.v=t,this.k=n}function p(t,n,e,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void e(t)}c.done?n(u):Promise.resolve(u).then(r,o)}function d(t){return function(){var n=this,e=arguments;return new Promise((function(r,o){var i=t.apply(n,e);function a(t){p(i,r,o,a,c,"next",t)}function c(t){p(i,r,o,a,c,"throw",t)}a(void 0)}))}}var v="citycare-cache-v2",h=["index.html","app.bundle.js","app.css","manifest.webmanifest","images/map.png"];function y(){return(y=d(r().mark((function t(){var e,o,i,a;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,new Promise((function(t,n){var e=indexedDB.open("citycare-db",1);e.onsuccess=function(){return t(e.result)},e.onerror=function(){return n(e.error)}}));case 3:return e=t.sent,o=e.transaction("outbox","readwrite"),i=o.objectStore("outbox"),(a=i.getAll()).onsuccess=d(r().mark((function t(){var e,o,c,u,s,f;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=a.result||[],o=n(e),t.prev=2,o.s();case 4:if((c=o.n()).done){t.next=23;break}return u=c.value,t.prev=6,s=new FormData,u.description&&s.append("description",u.description),u.photoBlob&&s.append("photo",u.photoBlob,u.photoName||"photo.jpg"),u.lat&&s.append("lat",u.lat),u.lon&&s.append("lon",u.lon),t.next=14,fetch("https://story-api.dicoding.dev/v1/stories",{method:"POST",headers:{Authorization:"Bearer ".concat(u.token)},body:s});case 14:(f=t.sent)&&f.ok&&i.delete(u.id),t.next=21;break;case 18:t.prev=18,t.t0=t.catch(6),console.error("Sync item failed",u,t.t0);case 21:t.next=4;break;case 23:t.next=28;break;case 25:t.prev=25,t.t1=t.catch(2),o.e(t.t1);case 28:return t.prev=28,o.f(),t.finish(28);case 31:case"end":return t.stop()}}),t,null,[[2,25,28,31],[6,18]])}))),t.next=10,o.complete;case 10:t.next=15;break;case 12:t.prev=12,t.t0=t.catch(0),console.error("Sync outbox error",t.t0);case 15:case"end":return t.stop()}}),t,null,[[0,12]])})))).apply(this,arguments)}self.addEventListener("install",(function(t){t.waitUntil(caches.open(v).then((function(t){return t.addAll(h)}))),self.skipWaiting()})),self.addEventListener("activate",(function(t){t.waitUntil(d(r().mark((function t(){var n;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,caches.keys();case 2:return n=t.sent,t.next=5,Promise.all(n.filter((function(t){return t!==v})).map((function(t){return caches.delete(t)})));case 5:return t.next=7,self.clients.claim();case 7:case"end":return t.stop()}}),t)})))())})),self.addEventListener("fetch",(function(t){if("GET"===t.request.method){var n=t.request,e=new URL(n.url);e.pathname.includes("/v1")||e.pathname.includes("/stories")?t.respondWith(fetch(n).catch((function(){return new Response(JSON.stringify({error:!0,message:"Jaringan gagal atau Anda offline"}),{status:503,headers:{"Content-Type":"application/json"}})}))):"navigate"!==n.mode?t.respondWith(caches.match(n).then((function(t){return t||fetch(n).then((function(t){if(!t||200!==t.status||"GET"!==n.method||!n.url.startsWith("http"))return t;var e=t.clone();return caches.open(v).then((function(t){return t.put(n,e)})),t}))}))):t.respondWith(d(r().mark((function t(){var e;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch(n);case 3:return e=t.sent,t.abrupt("return",e);case 7:return t.prev=7,t.t0=t.catch(0),console.log("Network request failed, serving app shell from cache."),t.next=12,caches.match("index.html");case 12:return t.abrupt("return",t.sent);case 13:case"end":return t.stop()}}),t,null,[[0,7]])})))())}else console.log("SW: Mengabaikan request non-GET (POST/PUT/DELETE).")})),self.addEventListener("push",(function(t){var n={title:"Notifikasi",body:"Ada notifikasi baru.",icon:"/images/map.png",url:"/",tag:"citycare",actions:[],data:{}};if(t.data)try{var e=t.data.json();n.title=e.title||n.title,n.body=e.body||n.body,n.icon=e.icon||n.icon,n.url=e.url||n.url,n.actions=e.actions||n.actions,n.tag=e.tag||n.tag,n.data=e.data||n.data}catch(e){try{n.body=t.data.text()}catch(t){}}var r={body:n.body,icon:n.icon,tag:n.tag,data:{url:n.url,extra:n.data},actions:n.actions};t.waitUntil(self.registration.showNotification(n.title,r))})),self.addEventListener("notificationclick",(function(t){var e;t.notification.close();var r=(null===(e=t.notification.data)||void 0===e?void 0:e.url)||"/";t.waitUntil(clients.matchAll({type:"window",includeUncontrolled:!0}).then((function(t){var e,o=n(t);try{for(o.s();!(e=o.n()).done;){var i=e.value;if(i.url===r&&"focus"in i)return i.focus()}}catch(t){o.e(t)}finally{o.f()}if(clients.openWindow)return clients.openWindow(r)})))})),self.addEventListener("sync",(function(t){"sync-new-stories"===t.tag&&t.waitUntil(function(){return y.apply(this,arguments)}())}))})();